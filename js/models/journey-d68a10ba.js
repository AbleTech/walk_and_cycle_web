!function(){var t,e={}.hasOwnProperty,n=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t};JourneyPlanner.Models.Journey=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype.defaults={mode:"walking",altitude_factor:1.13046330315024},o.prototype.initialize=function(){var t=this;return this.waypoints=new JourneyPlanner.Collections.Waypoints,this.waypoints.journey=this,this.steps=new JourneyPlanner.Collections.Steps,this.set("pace",$.cookie("jp_speed")||"average"),this.on("change",function(){return t.waypoints.reset(t.get("waypoints")),t.steps.reset(t.get("steps"))}),this.on("change:pace",function(){return $.cookie("jp_speed",t.get("pace"),{path:"/",expires:365})}),this.on("sync",function(){return t.get("encoded_polyline")&&t.updateMap(),$("a[href='#results']").show().tab("show")})},o.prototype.validate=function(t){var e,n;return e=[],this.get("example")||(_(["walking","cycling"]).indexOf(t.mode)>=0||e.push(""+t.mode+" is not a valid mode"),n=this.waypoints.filter(function(t){return t.isValid()}),n.length>1||e.push("you need a minimum of two waypoints")),e.length>0?e:void 0},o.prototype.url=function(){var t;return t="mode="+this.get("mode"),this.waypoints.each(function(e){return t+="&"+e.queryStr()}),"http://staging.journeyplanner.org.nz/api/route.json?callback=?&"+t},o.prototype.parse=function(t){return t.success&&t.total>0?t.journeys[0]:void 0},o.prototype.total_time=function(){return 60*(this.get("total_distance")/(1e3*this.currentSpeed()))},o.prototype.car_cost=function(){return JourneyPlanner.CAR_COST[this.get("mode")]*(this.get("total_distance")/1e3)},o.prototype.health_cost=function(){return JourneyPlanner.HEALTH_COST[this.get("mode")]*(this.get("total_distance")/1e3)},o.prototype.carbon_saving=function(){return.214*(this.get("total_distance")/1e3)},o.prototype.calculate_calories=function(t){return Math.round(t*this.total_time()*this.currentEffort()*this.get("altitude_factor"))},o.prototype.currentSpeed=function(){return JourneyPlanner.SPEEDS[this.get("mode")][this.get("pace")]},o.prototype.currentEffort=function(){return JourneyPlanner.EFFORT[this.get("mode")][this.get("pace")]},o.prototype.elevation_marker=function(){return this._elevation_marker||(this._elevation_marker=new google.maps.Marker({map:JourneyPlanner.App.map,icon:this.elevation_icon()}))},o.prototype.elevation_icon=function(){return{anchor:new google.maps.Point(14,34),url:"img/elevation_markers/icon_"+this.get("mode")+".png"}},o.prototype.showElevationMarker=function(t){var e;return null==t&&(t=0),e=t*this.get("total_distance"),this.elevation_marker().setOptions({position:this.pointAlongPath(e),visible:!0})},o.prototype.hideElevationMarker=function(){return this.elevation_marker().setVisible(!1)},o.prototype.pointAlongPath=function(t){var e,n,o=this;return null==t&&(t=0),n=null,null!=this.polyline()&&(e=0,this.polyline().getPath().forEach(function(r,i){var a,p,s;if(i>0&&null===n){if(p=o.polyline().getPath().getAt(i-1),s=google.maps.geometry.spherical.computeDistanceBetween(p,r),!(e+s>t))return e+=s;a=(t-e)/s,n=google.maps.geometry.spherical.interpolate(p,r,a)}})),n},o.prototype.showOverlays=function(t){var e,n,o,r,i,a;for(null!=(r=this.polyline())&&r.setMap(t),i=this.waypointMarkers(),a=[],n=0,o=i.length;o>n;n++)e=i[n],a.push(e.setMap(t));return a},o.prototype.hideOverlays=function(){return this.showOverlays(null)},o.prototype.polyline=function(){return this.get("encoded_polyline")?this._polyline||(this._polyline=new google.maps.Polyline({map:JourneyPlanner.App.map,path:google.maps.geometry.encoding.decodePath(this.get("encoded_polyline").polyline),strokeColor:"#2564a5",strokeWeight:4,strokeOpacity:.7})):void 0},o.prototype.waypointMarkers=function(){return this.waypoints.map(function(t){var e;return e=t.getMarker()})},o.prototype.updateMap=function(){return null!=JourneyPlanner.App.map?(JourneyPlanner.App.map.fitBounds(this.steps.bounding_box()),this.showOverlays(JourneyPlanner.App.map)):void 0},o}(Backbone.Model)}.call(this);