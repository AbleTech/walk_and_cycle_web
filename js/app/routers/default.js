!function(){var e={}.hasOwnProperty,n=function(n,o){function t(){this.constructor=n}for(var r in o)e.call(o,r)&&(n[r]=o[r]);return t.prototype=o.prototype,n.prototype=new t,n.__super__=o.prototype,n};define(["underscore","backbone","jquery","app/models/journey","app/views/composites/sidebar","app/views/composites/journey_form","app/views/items/details_content","app/views/items/error_sidebar","jquery.bbq"],function(e,o,t,r,i,a,s,u){var p,y;return p=function(o){function p(){return y=p.__super__.constructor.apply(this,arguments)}return n(p,o),p.prototype.routes={"*query_string":"loadJourney"},p.prototype.legacyParamMap=[{regex:/^x([0-9]*)/,new_key:"x"},{regex:/^y([0-9]*)/,new_key:"y"},{regex:/^a([0-9]*)/,new_key:"a"}],p.prototype.loadJourney=function(){var n,o,i;return n=t.deparam.querystring(),this.fixLegacyParams(n),null!=(o=this.journey)&&o.hideOverlays(),null!=n.example?(this.journey=new r({example:n.example}),this.journey.waypoints.add([{},{}])):(this.journey=new r({mode:n.mode}),(null!=(i=n.waypoints)?i.length:void 0)>=2?this.journey.waypoints.add(e(n.waypoints).compact()):(this.journey.waypoints.add([{},{}]),App.showExamples())),this.renderJourney()},p.prototype.renderJourney=function(){var e=this;return App.resultsRegion.show(new i({model:this.journey,collection:this.journey.steps})),App.journeyFields.show(new a({model:this.journey,collection:this.journey.waypoints})),App.detailContent.show(new s({model:this.journey})),t("#link-modal textarea").val(location.href),this.journey.isValid()?(t("title").text(""+this.journey.waypoints.first().streetName()+" to "+this.journey.waypoints.last().streetName()+" | Cycling and Walking Journey Planner"),t("#global_loading_indicator").show(),this.journey.fetch({success:function(){return t("#global_loading_indicator").hide()},error:function(){return t("#global_loading_indicator").hide(),App.resultsRegion.show(new u({model:e.journey}))}})):void 0},p.prototype.fixLegacyParams=function(n){var o,t=this;return null==n&&(n={}),o=e(n).clone(),n.waypoints||(n.waypoints=[]),e(n).each(function(o,r){return e(t.legacyParamMap).each(function(e){var t,i,a;return null!=(i=r.match(e.regex))?(t=""===i[1]?0:parseInt(i[1],10),(a=n.waypoints)[t]||(a[t]={}),n.waypoints[t][e.new_key]=o,delete n[r]):void 0})})},p}(o.Router)})}.call(this);