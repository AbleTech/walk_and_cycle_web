!function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,r=function(e,r){function a(){this.constructor=e}for(var n in r)t.call(r,n)&&(e[n]=r[n]);return a.prototype=r.prototype,e.prototype=new a,e.__super__=r.prototype,e};define(["underscore","jquery","app/collections/points_of_interest","context_menu","jquery.cookie"],function(t,a,n,o){var p;return p=function(t){function p(t){this.updateMaptype=e(this.updateMaptype,this),this.updateOverlay=e(this.updateOverlay,this);var r=this;p.__super__.constructor.call(this,t,this.map_opts),this.context_menu=new o(this,{classNames:{menu:"dropdown-menu",menuSeparator:"divider"},menuItems:[{className:"",eventName:"start_point",label:'<a href="#">Set as start point.</a>'},{className:"",eventName:"end_point",label:'<a href="#">Set as end point.</a>'}]}),google.maps.event.addListener(this,"maptypeid_changed",function(){return a.cookie("jp_maptype",r.getMapTypeId(),{path:"/",expires:365})}),google.maps.event.addListener(this,"rightclick",function(e){return r.context_menu.show(e.latLng)}),this.setupLayers()}return r(p,t),p.prototype.map_opts={center:new google.maps.LatLng(-41.105,175.288),zoom:9,mapTypeId:a.cookie("jp_maptype")||google.maps.MapTypeId.ROADMAP,scaleControl:!0,mapTypeControl:!1},p.prototype.setupLayers=function(){return this.pois=new n,this.weather_layer=new google.maps.weather.WeatherLayer({temperatureUnits:google.maps.weather.TemperatureUnit.CELCIUS}),this.bike_layer=new google.maps.KmlLayer("http://journeyplanner.org.nz/mobile_combined-0.2.1.kml",{clickable:!1,preserveViewport:!0,suppressInfoWindows:!0}),this.traffic_layer=new google.maps.TrafficLayer},p.prototype.updateOverlay=function(e){var t,r;return null!=(t=this.current_overlay)&&t.setMap(null),this.current_overlay=function(){switch(e){case"paths":return this.bike_layer;case"poi":return this.pois;case"traffic":return this.traffic_layer;case"weather":return this.weather_layer}}.call(this),null!=(r=this.current_overlay)&&r.setMap(this),a.cookie("jp_overlay",e,{path:"/",expires:365})},p.prototype.updateMaptype=function(e){var t;return t=function(){switch(e){case"map":return google.maps.MapTypeId.ROADMAP;case"terrain":return google.maps.MapTypeId.TERRAIN;case"aerial":return google.maps.MapTypeId.HYBRID}}(),this.setMapTypeId(t)},p}(google.maps.Map)})}.call(this);