!function(){var e={}.hasOwnProperty,o=function(o,n){function r(){this.constructor=o}for(var t in n)e.call(n,t)&&(o[t]=n[t]);return r.prototype=n.prototype,o.prototype=new r,o.__super__=n.prototype,o};define(["underscore","backbone","jquery","app/models/journey","app/views/composites/sidebar","app/views/composites/journey_form","app/views/items/details_content","app/views/items/error_sidebar","jquery.bbq"],function(e,n,r,t,i,a,s,p){var u,l;return u=function(n){function u(){return l=u.__super__.constructor.apply(this,arguments)}return o(u,n),u.prototype.routes={"*query_string":"loadJourney"},u.prototype.legacyParamMap=[{regex:/^x([0-9]*)/,new_key:"x"},{regex:/^y([0-9]*)/,new_key:"y"},{regex:/^a([0-9]*)/,new_key:"a"}],u.prototype.loadJourney=function(){var o,n,i;return o=r.deparam.querystring(),this.fixLegacyParams(o),null!=(n=this.journey)&&n.hideOverlays(),null!=o.example?(this.journey=new t({example:o.example}),this.journey.waypoints.add([{},{}])):(this.journey=new t({mode:o.mode}),(null!=(i=o.waypoints)?i.length:void 0)>=2?this.journey.waypoints.add(e(o.waypoints).compact()):(this.journey.waypoints.add([{},{}]),App.showExamples())),this.renderJourney()},u.prototype.renderJourney=function(){var e=this;return App.resultsRegion.show(new i({model:this.journey,collection:this.journey.steps})),App.journeyFields.show(new a({model:this.journey,collection:this.journey.waypoints})),App.detailContent.show(new s({model:this.journey})),r("#link-modal textarea").val(location.href),this.journey.isValid()?(r("#global_loading_indicator").show(),this.journey.fetch({success:function(){return r("#global_loading_indicator").hide()},error:function(o){return console.log(o),r("#global_loading_indicator").hide(),App.resultsRegion.show(new p({model:e.journey}))}})):void 0},u.prototype.fixLegacyParams=function(o){var n,r=this;return null==o&&(o={}),n=e(o).clone(),o.waypoints||(o.waypoints=[]),e(o).each(function(n,t){return e(r.legacyParamMap).each(function(e){var r,i,a;return null!=(i=t.match(e.regex))?(r=""===i[1]?0:parseInt(i[1],10),(a=o.waypoints)[r]||(a[r]={}),o.waypoints[r][e.new_key]=n,delete o[t]):void 0})})},u}(n.Router)})}.call(this);